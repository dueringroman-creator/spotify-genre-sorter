<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playlist Alchemist</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Playlist Alchemist</h1>
    <button id="help-button" class="help-button" title="Show help tour">?</button>
    
    <!-- ========== LOGIN SECTION ========== -->
    <div id="login-section" class="section">
      <button id="login-btn" class="btn-primary btn-large">Let's see your music taste</button>
      <p class="subtitle">Discover and create personalized playlists</p>
    </div>

    <!-- ========== MAIN APP (Hidden until logged in) ========== -->
    <div id="app-section" class="section hidden">
      
      <!-- ========== WELCOME TOUR MODAL ========== -->
      <div id="tour-overlay" class="tour-overlay hidden">
        <div class="tour-step" id="tour-step-1">
          <div class="tour-content">
            <h3>Welcome to Playlist Alchemist</h3>
            <p>Ever saved <strong>thousands of songs</strong> on Spotify but felt too lazy to actually organize them into playlists?</p>
            <p><strong>Same.</strong> This tool does the heavy lifting for you.</p>
            <div class="tour-actions">
              <button class="btn-small" onclick="closeTour()">Skip Tour</button>
              <button class="btn-primary" onclick="nextTourStep(2)">Let's Go! ‚Üí</button>
            </div>
          </div>
        </div>
        
        <div class="tour-step hidden" id="tour-step-2">
          <div class="tour-content">
            <h3>How It Works</h3>
            <p><strong>Step 1:</strong> Choose where to pull your music from:</p>
            <ul>
              <li><strong>Liked Songs</strong> - Perfect for large collections (cached for speed!)</li>
              <li><strong>Top Artists</strong> - Your most-listened artists</li>
              <li><strong>Playlists</strong> - Scan all your existing playlists</li>
            </ul>
            <p><strong>Step 2:</strong> We ask Spotify: "What genres are these artists?"</p>
            <p><strong>Step 3:</strong> Choose your view mode and select genres!</p>
            <div class="tour-actions">
              <button class="btn-small" onclick="prevTourStep(1)">‚Üê Back</button>
              <button class="btn-primary" onclick="nextTourStep(3)">Next ‚Üí</button>
            </div>
          </div>
        </div>
        
        <div class="tour-step hidden" id="tour-step-3">
          <div class="tour-content">
            <h3>Three Ways to View Genres</h3>
            <p>Spotify has 200+ messy micro-genres. We clean them up for you:</p>
            <ul>
              <li><strong>Genre Families</strong> - Grouped (House, Techno, Rock). One click = all sub-genres!</li>
              <li><strong>Detailed</strong> - Expandable families. Pick specific sub-genres if you want.</li>
              <li><strong>All Genres</strong> - Flat list of everything. For power users.</li>
            </ul>
            <p><strong>Tip:</strong> Start with "Genre Families" - it's the easiest!</p>
            <p><strong>Advanced:</strong> Click "Show Artists" on any genre to see which artists are included. You can even expand individual artists to see their tracks and uncheck specific songs!</p>
            <div class="tour-actions">
              <button class="btn-small" onclick="prevTourStep(2)">‚Üê Back</button>
              <button class="btn-primary" onclick="nextTourStep(4)">Next ‚Üí</button>
            </div>
          </div>
        </div>
        
        <div class="tour-step hidden" id="tour-step-4">
          <div class="tour-content">
            <h3>Bonus Features</h3>
            <p><strong>3-Level Control:</strong> Click "Show Artists" to see who's in each genre. Click "Show Tracks" to drill down to individual songs. Uncheck anything you don't want!</p>
            <p><strong>Manual Genre Mapping:</strong> See a genre in "Other" that should be elsewhere? Click the orange "Map to Family" button to assign it yourself. Your mappings are saved forever!</p>
            <p><strong>Export & Discovery:</strong> Download playlists as CSV/TXT for DJ software. Find similar artists from your library in the Artist Discovery tab.</p>
            <p><strong>Music Stats:</strong> See your top genres, diversity score, and fun insights about your taste!</p>
            <div class="tour-actions">
              <button class="btn-small" onclick="prevTourStep(3)">‚Üê Back</button>
              <button class="btn-primary" onclick="nextTourStep(5)">Next ‚Üí</button>
            </div>
          </div>
        </div>
        
        <div class="tour-step hidden" id="tour-step-5">
          <div class="tour-content">
            <h3>Your Privacy Matters</h3>
            <p><strong>No servers. No data storage.</strong></p>
            <p>Everything runs in <em>your browser</em>. We cache data locally for speed, but it never leaves your device.</p>
            <p style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #282828; font-size: 13px; color: #7f7f7f;">
              Open source ‚Ä¢ No ads ‚Ä¢ No tracking
            </p>
            <div class="tour-actions">
              <button class="btn-small" onclick="prevTourStep(4)">‚Üê Back</button>
              <button class="btn-primary" onclick="closeTour()">Start Using It</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ========== TAB NAVIGATION ========== -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="library">My Library</button>
        <button class="tab-btn" data-tab="discovery">Artist Discovery</button>
        <button class="tab-btn" data-tab="stats">Music Stats</button>
        <button class="tab-btn" data-tab="history">History</button>
      </div>

      <!-- ========== TAB CONTENT: MY LIBRARY ========== -->
      <div id="library-tab" class="tab-content active">
        <h2>Create Playlist from Your Music Library</h2>
        
        <!-- Data Source Selection -->
        <div class="data-source-section">
          <h3>Step 1: Choose Your Data Source</h3>
          
          <div class="data-source-options">
            <label class="source-option">
              <input type="radio" name="data-source" value="liked-songs" checked>
              <div class="source-content">
                <span class="source-title">Liked Songs</span>
                <span class="source-desc">Your entire liked songs collection - perfect for big libraries!</span>
              </div>
            </label>
            
            <label class="source-option">
              <input type="radio" name="data-source" value="top-artists">
              <div class="source-content">
                <span class="source-title">Top Artists</span>
                <span class="source-desc">Your top 50 most-played artists - quick and personalized</span>
              </div>
            </label>
            
            <label class="source-option">
              <input type="radio" name="data-source" value="playlists">
              <div class="source-content">
                <span class="source-title">My Playlists</span>
                <span class="source-desc">Select specific playlists to analyze</span>
              </div>
            </label>
          </div>
          
          <!-- Timeframe Selection (Only for Liked Songs) -->
          <div id="timeframe-section" class="timeframe-section">
            <h4>Timeframe:</h4>
            <div class="timeframe-options">
              <label class="timeframe-option">
                <input type="radio" name="timeframe" value="all" checked>
                <span>All Time</span>
              </label>
              <label class="timeframe-option">
                <input type="radio" name="timeframe" value="year">
                <span>1 Year</span>
              </label>
              <label class="timeframe-option">
                <input type="radio" name="timeframe" value="6months">
                <span>6 Months</span>
              </label>
              <label class="timeframe-option">
                <input type="radio" name="timeframe" value="3months">
                <span>3 Months</span>
              </label>
              <label class="timeframe-option">
                <input type="radio" name="timeframe" value="month">
                <span>1 Month</span>
              </label>
              <label class="timeframe-option">
                <input type="radio" name="timeframe" value="week">
                <span>1 Week</span>
              </label>
            </div>
          </div>
          
          <!-- Playlist Selection (Only for Playlists source) -->
          <div id="playlist-selection-section" class="playlist-selection-section hidden">
            <h4>Select Playlists to Analyze:</h4>
            <div id="playlist-checklist" class="playlist-checklist">
              <!-- Populated dynamically -->
            </div>
            <div class="playlist-selection-actions">
              <button id="select-all-playlists" class="btn-small">Select All</button>
              <button id="clear-all-playlists" class="btn-small">Clear All</button>
            </div>
          </div>
          
          <div class="library-controls">
            <button id="load-library-btn" class="btn-primary btn-large">Load Library</button>
            <button id="refresh-cache-btn" class="btn-small" style="display: none;">Refresh Cache</button>
          </div>
          
          <div id="cache-info" class="cache-info" style="display: none;"></div>
          <div id="load-progress" class="load-progress" style="display: none;">
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p id="progress-text">Loading...</p>
          </div>
        </div>

        <!-- Genre Selection Area -->
        <div id="genre-selection-area" class="genre-selection-area hidden">
          <div class="genre-header">
            <h3>Step 2: Select Genres</h3>
            <div class="genre-controls">
              <select id="genre-view-mode" class="view-mode-select">
                <option value="families">Genre Families (Grouped)</option>
                <option value="detailed">Detailed (Expandable)</option>
                <option value="all">All Genres (Flat)</option>
              </select>
              <input type="text" id="genre-filter" class="genre-filter" placeholder="Filter genres..." />
              <button id="select-all-genres" class="btn-small">Select All</button>
              <button id="clear-all-genres" class="btn-small">Clear All</button>
            </div>
          </div>
          
          <div id="genre-stats" class="genre-stats"></div>
          
          <div id="genre-list" class="genre-list">
            <!-- Populated dynamically -->
          </div>
        </div>
      </div>

      <!-- ========== TAB CONTENT: ARTIST DISCOVERY ========== -->
      <div id="discovery-tab" class="tab-content">
        <h2>Artist Discovery</h2>
        <p>Find similar artists from your library. Coming soon!</p>
      </div>

      <!-- ========== TAB CONTENT: MUSIC STATS ========== -->
      <div id="stats-tab" class="tab-content">
        <h2>Music Statistics</h2>
        <p>See your top genres, diversity score, and insights. Coming soon!</p>
      </div>

      <!-- ========== TAB CONTENT: HISTORY ========== -->
      <div id="history-tab" class="tab-content">
        <h2>Playlist History</h2>
        <p>View and recreate past playlists. Coming soon!</p>
      </div>

      <!-- ========== FLOATING ACTION BUTTON ========== -->
      <div id="floating-action-button" class="floating-action-button hidden">
        <!-- State 1: Collapsed (Small) -->
        <button class="fab-collapsed" id="fab-collapsed">
          <span class="fab-icon">üéµ</span>
          <span class="fab-count" id="fab-count">0</span>
        </button>
        
        <!-- State 2: Expanded (Medium) -->
        <div class="fab-expanded hidden" id="fab-expanded">
          <div class="fab-expanded-header">
            <button class="fab-close" onclick="collapseFAB()">‚úï</button>
            <h4>Create Playlist</h4>
          </div>
          
          <div class="fab-expanded-content">
            <div class="input-group">
              <label>Playlist Name</label>
              <input type="text" id="playlist-name" placeholder="My Playlist" value="My Playlist">
            </div>
            
            <div class="input-group">
              <label>Mode</label>
              <div class="playlist-mode-options">
                <label>
                  <input type="radio" name="playlist-mode" value="merged" checked>
                  <span>Merged (1 playlist)</span>
                </label>
                <label>
                  <input type="radio" name="playlist-mode" value="separate">
                  <span>Separate (1 per genre)</span>
                </label>
              </div>
            </div>
            
            <div class="fab-actions">
              <button class="btn-secondary" onclick="expandFABFull()">More Options</button>
              <button class="btn-primary" id="create-playlist-btn">Create</button>
            </div>
          </div>
        </div>
        
        <!-- State 3: Full (Large) -->
        <div class="fab-full hidden" id="fab-full">
          <div class="fab-full-header">
            <button class="fab-close" onclick="collapseFAB()">‚úï</button>
            <h4>Playlist Creator</h4>
            <button class="fab-minimize" onclick="minimizeFABToExpanded()">‚ñº</button>
          </div>
          
          <div class="fab-full-content">
            <div class="input-group">
              <label>Playlist Name</label>
              <input type="text" id="playlist-name-full" placeholder="My Playlist" value="My Playlist">
            </div>
            
            <div class="input-group">
              <label>Mode</label>
              <div class="playlist-mode-options">
                <label>
                  <input type="radio" name="playlist-mode-full" value="merged" checked>
                  <span>Merged</span>
                </label>
                <label>
                  <input type="radio" name="playlist-mode-full" value="separate">
                  <span>Separate</span>
                </label>
              </div>
            </div>
            
            <div class="input-group">
              <label>
                <input type="checkbox" id="smart-shuffle">
                Smart Shuffle
              </label>
            </div>
            
            <div class="input-group">
              <label>Filters & Sorting</label>
              <select id="sort-order">
                <option value="default">Default Order</option>
                <option value="artist">By Artist</option>
                <option value="genre">By Genre</option>
                <option value="random">Random</option>
              </select>
            </div>
            
            <div id="selected-tracks-preview" class="selected-tracks-preview">
              <!-- Show selected tracks with drag-and-drop reordering -->
            </div>
            
            <div class="fab-actions">
              <button class="btn-primary btn-full" id="create-playlist-btn-full">Create Playlist</button>
            </div>
          </div>
        </div>
      </div>

    </div>
    <!-- END APP SECTION -->

  </div>
  <!-- END CONTAINER -->

  <script src="app.js"></script>
</body>
</html>
